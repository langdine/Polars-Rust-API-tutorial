<!DOCTYPE HTML>
<html lang="zh_CN" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Complex Aggregation and Custom Functions</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/index.html"><strong aria-hidden="true">1.</strong> Home page</a></li><li class="chapter-item expanded affix "><li class="part-title">English</li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/main.html"><strong aria-hidden="true">2.</strong> English</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/编译feature设置.html"><strong aria-hidden="true">3.</strong> Compile Feature Settings</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/基本概念.html"><strong aria-hidden="true">4.</strong> Basic Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/基本概念-索引.html"><strong aria-hidden="true">4.1.</strong> Indexing</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/基本概念-上下文.html"><strong aria-hidden="true">4.2.</strong> Expressions and Contexts</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/基本概念-数据类型.html"><strong aria-hidden="true">4.3.</strong> Data Types</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/基本概念-数据类型转换.html"><strong aria-hidden="true">4.4.</strong> Data Type Conversions</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/基本概念-Categorical分类变量.html"><strong aria-hidden="true">4.5.</strong> Categorical Variables</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/基本概念-Null和None和NaN.html"><strong aria-hidden="true">4.6.</strong> Null and None and NaN</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/基本概念-缺失数据的处理.html"><strong aria-hidden="true">4.7.</strong> Handling of Missing Data</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/数据操作.html"><strong aria-hidden="true">5.</strong> Data Manipulation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/示例数据.html"><strong aria-hidden="true">5.1.</strong> Example Data</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO.html"><strong aria-hidden="true">5.2.</strong> IO</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-从CSV构建Dataframe.html"><strong aria-hidden="true">5.2.1.</strong> Creating Dataframe from CSV</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-从CSV创建lazyframe.html"><strong aria-hidden="true">5.2.2.</strong> Creating lazyframe from CSV</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-Schema.html"><strong aria-hidden="true">5.2.3.</strong> Schema</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-写入CSV文件.html"><strong aria-hidden="true">5.2.4.</strong> Writing to CSV files</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-从parquet格式构建Dataframe.html"><strong aria-hidden="true">5.2.5.</strong> Creating Dataframe from parquet format</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-从parquet格式构建lazyframe.html"><strong aria-hidden="true">5.2.6.</strong> Creating lazyframe from parquet format</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-写入parquet格式.html"><strong aria-hidden="true">5.2.7.</strong> Writing to parquet</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-从Json创建Dataframe.html"><strong aria-hidden="true">5.2.8.</strong> Creating a Dataframe from Json</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-从Json创建LazyFrame.html"><strong aria-hidden="true">5.2.9.</strong> Creating LazyFrame from Json</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/IO-写入Json.html"><strong aria-hidden="true">5.2.10.</strong> Writing to Json</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Series.html"><strong aria-hidden="true">5.3.</strong> Series</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Series-构造Series.html"><strong aria-hidden="true">5.3.1.</strong> Constructing Series</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Series-索引Series.html"><strong aria-hidden="true">5.3.2.</strong> Indexing Series</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Series-读取单个元素.html"><strong aria-hidden="true">5.3.3.</strong> Reading Individual Elements</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Series-遍历值.html"><strong aria-hidden="true">5.3.4.</strong> Iterating over values</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Series-算数运算.html"><strong aria-hidden="true">5.3.5.</strong> Arithmetic Operations</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Series-Series常用API.html"><strong aria-hidden="true">5.3.6.</strong> Common APIs for Series</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe.html"><strong aria-hidden="true">5.4.</strong> Dataframe</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe-构造Dataframe.html"><strong aria-hidden="true">5.4.1.</strong> Constructing Dataframes</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe-索引Dataframe.html"><strong aria-hidden="true">5.4.2.</strong> Indexing Dataframes</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe-分组和简单聚合.html"><strong aria-hidden="true">5.4.3.</strong> Grouping and Simple Aggregation</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe-复杂聚合和自定义函数.html" class="active"><strong aria-hidden="true">5.4.4.</strong> Complex Aggregation and Custom Functions</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe-Join操作.html"><strong aria-hidden="true">5.4.5.</strong> Join Operations</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe-数据透视Pivots.html"><strong aria-hidden="true">5.4.6.</strong> Pivots</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe-DataframeAPI.html"><strong aria-hidden="true">5.4.7.</strong> Dataframe API</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Dataframe-行迭代.html"><strong aria-hidden="true">5.4.8.</strong> Row Iteration</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Lazyframe操作.html"><strong aria-hidden="true">5.5.</strong> Lazyframe Operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Lazyframe操作-构造Lazyframe.html"><strong aria-hidden="true">5.5.1.</strong> Constructing Lazyframes</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Lazyframe操作-索引LazyFrame.html"><strong aria-hidden="true">5.5.2.</strong> Indexing LazyFrame</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Lazyframe操作-表达式.html"><strong aria-hidden="true">5.5.3.</strong> Expressions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/表达式-表达式上下文.html"><strong aria-hidden="true">5.5.3.1.</strong> Expression Context</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/表达式-基本运算.html"><strong aria-hidden="true">5.5.3.2.</strong> Basic Operations</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/表达式-列选择.html"><strong aria-hidden="true">5.5.3.3.</strong> Column Selection</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/表达式-重命名alias.html"><strong aria-hidden="true">5.5.3.4.</strong> Field Renaming</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/表达式-条件运算-when.html"><strong aria-hidden="true">5.5.3.5.</strong> Conditional Operations "when"</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/表达式-表达式方法.html"><strong aria-hidden="true">5.5.3.6.</strong> Expression Methods</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/表达式-字符串操作.html"><strong aria-hidden="true">5.5.3.7.</strong> String Operations</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Lazyframe操作-分组和聚合.html"><strong aria-hidden="true">5.5.4.</strong> Lazyframe Grouping and Aggregation</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/Lazyframe操作-Lazyframe-API.html"><strong aria-hidden="true">5.5.5.</strong> Lazyframe API</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/代码参考.html"><strong aria-hidden="true">6.</strong> Code Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/代码参考-agg_groups示例.html"><strong aria-hidden="true">6.1.</strong> agg_groups</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/代码参考-map示例.html"><strong aria-hidden="true">6.2.</strong> map example</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/en/代码参考-over示例.html"><strong aria-hidden="true">6.3.</strong> over example</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">中文版</li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/main.html"><strong aria-hidden="true">7.</strong> 中文版</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/编译feature设置.html"><strong aria-hidden="true">8.</strong> 编译feature设置</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/基本概念.html"><strong aria-hidden="true">9.</strong> 基本概念</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/基本概念-索引.html"><strong aria-hidden="true">9.1.</strong> 索引</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/基本概念-上下文.html"><strong aria-hidden="true">9.2.</strong> 表达式和上下文</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/基本概念-数据类型.html"><strong aria-hidden="true">9.3.</strong> 数据类型</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/基本概念-数据类型转换.html"><strong aria-hidden="true">9.4.</strong> 数据类型转换</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/基本概念-Categorical分类变量.html"><strong aria-hidden="true">9.5.</strong> Categorical分类变量</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/基本概念-Null和None和NaN.html"><strong aria-hidden="true">9.6.</strong> Null和None和NaN</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/基本概念-缺失数据的处理.html"><strong aria-hidden="true">9.7.</strong> 缺失数据的处理</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/数据操作.html"><strong aria-hidden="true">10.</strong> 数据操作</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/示例数据.html"><strong aria-hidden="true">10.1.</strong> 示例数据</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO.html"><strong aria-hidden="true">10.2.</strong> IO</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-从CSV构建Dataframe.html"><strong aria-hidden="true">10.2.1.</strong> 从CSV构建Dataframe</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-从CSV创建lazyframe.html"><strong aria-hidden="true">10.2.2.</strong> 从CSV创建lazyframe</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-Schema.html"><strong aria-hidden="true">10.2.3.</strong> Schema</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-写入CSV文件.html"><strong aria-hidden="true">10.2.4.</strong> 写入CSV文件</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-从parquet格式构建Dataframe.html"><strong aria-hidden="true">10.2.5.</strong> 从parquet格式构建Dataframe</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-从parquet格式构建lazyframe.html"><strong aria-hidden="true">10.2.6.</strong> 从parquet格式构建lazyframe</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-写入parquet格式.html"><strong aria-hidden="true">10.2.7.</strong> 写入parquet格式</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-从Json创建Dataframe.html"><strong aria-hidden="true">10.2.8.</strong> 从Json创建Dataframe</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-从Json创建LazyFrame.html"><strong aria-hidden="true">10.2.9.</strong> 从Json创建LazyFrame</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/IO-写入Json.html"><strong aria-hidden="true">10.2.10.</strong> 写入Json</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Series.html"><strong aria-hidden="true">10.3.</strong> Series</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Series-构造Series.html"><strong aria-hidden="true">10.3.1.</strong> 构造Series</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Series-索引Series.html"><strong aria-hidden="true">10.3.2.</strong> 索引Series</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Series-读取单个元素.html"><strong aria-hidden="true">10.3.3.</strong> 读取单个元素</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Series-遍历值.html"><strong aria-hidden="true">10.3.4.</strong> 遍历值</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Series-算数运算.html"><strong aria-hidden="true">10.3.5.</strong> 算数运算</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Series-Series常用API.html"><strong aria-hidden="true">10.3.6.</strong> Series常用API</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe.html"><strong aria-hidden="true">10.4.</strong> Dataframe</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe-构造Dataframe.html"><strong aria-hidden="true">10.4.1.</strong> 构造Dataframe</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe-索引Dataframe.html"><strong aria-hidden="true">10.4.2.</strong> 索引Dataframe</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe-分组和简单聚合.html"><strong aria-hidden="true">10.4.3.</strong> 分组和简单聚合</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe-复杂聚合和自定义函数.html"><strong aria-hidden="true">10.4.4.</strong> 复杂聚合和自定义函数</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe-Join操作.html"><strong aria-hidden="true">10.4.5.</strong> Join操作</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe-数据透视Pivots.html"><strong aria-hidden="true">10.4.6.</strong> 数据透视Pivots</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe-DataframeAPI.html"><strong aria-hidden="true">10.4.7.</strong> Dataframe API</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Dataframe-行迭代.html"><strong aria-hidden="true">10.4.8.</strong> 行迭代</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Lazyframe操作.html"><strong aria-hidden="true">10.5.</strong> Lazyframe操作</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Lazyframe操作-构造Lazyframe.html"><strong aria-hidden="true">10.5.1.</strong> 构造Lazyframe</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Lazyframe操作-索引LazyFrame.html"><strong aria-hidden="true">10.5.2.</strong> 索引LazyFrame</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Lazyframe操作-表达式.html"><strong aria-hidden="true">10.5.3.</strong> 表达式</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/表达式-表达式上下文.html"><strong aria-hidden="true">10.5.3.1.</strong> 表达式上下文</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/表达式-基本运算.html"><strong aria-hidden="true">10.5.3.2.</strong> 基本运算</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/表达式-列选择.html"><strong aria-hidden="true">10.5.3.3.</strong> 列选择</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/表达式-重命名alias.html"><strong aria-hidden="true">10.5.3.4.</strong> 字段重命名</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/表达式-条件运算-when.html"><strong aria-hidden="true">10.5.3.5.</strong> 条件运算 when then otherwise</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/表达式-表达式方法.html"><strong aria-hidden="true">10.5.3.6.</strong> 表达式方法</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/表达式-字符串操作.html"><strong aria-hidden="true">10.5.3.7.</strong> 字符串操作</a></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Lazyframe操作-分组和聚合.html"><strong aria-hidden="true">10.5.4.</strong> Lazyframe分组和聚合</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/Lazyframe操作-Lazyframe-API.html"><strong aria-hidden="true">10.5.5.</strong> Lazyframe API</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/代码参考.html"><strong aria-hidden="true">11.</strong> 代码参考</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/代码参考-agg_groups示例.html"><strong aria-hidden="true">11.1.</strong> agg_groups示例</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/代码参考-map示例.html"><strong aria-hidden="true">11.2.</strong> map示例</a></li><li class="chapter-item expanded "><a href="../../Rust-Polars-API-tutorial/zh_cn/代码参考-over示例.html"><strong aria-hidden="true">11.3.</strong> over示例</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="complex-aggregation-and-custom-functions"><a class="header" href="#complex-aggregation-and-custom-functions">Complex Aggregation and Custom Functions</a></h1>
<ul>
<li>Simple Aggregation: Takes a single Series as input and outputs a Series with only one element.</li>
<li>Complex Aggregation: Takes multiple Series as input and outputs multiple rows and columns.</li>
</ul>
<p>Complex aggregation requires custom functions to compute the desired results.</p>
<h2 id="dataframe-complex-aggregation"><a class="header" href="#dataframe-complex-aggregation">DataFrame Complex Aggregation</a></h2>
<p><code>DataFrame.group_by(["date"])?.apply(F)</code> can be used to perform complex aggregation.</p>
<p>F is a custom function that must satisfy <code>|x: DataFrame| -&gt; Result&lt;DataFrame, PolarsError&gt;</code>. The grouped data is encapsulated into a DataFrame, allowing access to all fields. The function returns a DataFrame, and each group can return multiple rows and columns, but the order, names, and types of fields in the returned DataFrame must be consistent across different groups. You need to maintain the group field in the returned DataFrame.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut employee_df: DataFrame = df!(
    "Name" =&gt; ["Lao Li", "Lao Li", "Lao Li", "Lao Li", "Lao Zhang", "Lao Zhang", "Lao Zhang", "Lao Zhang", "Lao Wang", "Lao Wang", "Lao Wang", "Lao Wang"],
    "employee_ID" =&gt; ["Employee01", "Employee01", "Employee01", "Employee01", "Employee02", "Employee02", "Employee02", "Employee02", "Employee03", "Employee03", "Employee03", "Employee03"],
    "date" =&gt; ["August", "September", "October", "November", "August", "September", "October", "November", "August", "September", "October", "November"],
    "score" =&gt; [83, 24, 86, 74, 89, 59, 48, 79, 51, 71, 44, 90]
)?;

let f = |x: DataFrame| -&gt; Result&lt;DataFrame, PolarsError&gt; {
    let col1: &amp;Series = x.column("Name")?;
    let col2: &amp;Series = x.column("employee_ID")?;
    let col3: &amp;Series = x.column("score")?;
    let group_id = x.column("date")?.str()?.get(0).unwrap();
    // do something; We get those results below;
    let group_field = Series::new("group".into(), vec![group_id, group_id, group_id]);
    let res_field1 = Series::new("field1".into(), vec!["a1,1", "a2,1", "a3,1"]);
    let res_field2 = Series::new("field2".into(), vec!["a1,2", "a2,2", "a3,2"]);
    let res_field3 = Series::new("field3".into(), vec!["a1,3", "a2,3", "a3,3"]);
    let result = DataFrame::new(vec![group_field, res_field1, res_field2, res_field3])?;
    return Ok(result);
};

let res = employee_df.group_by(["date"])?.apply(f)?; // The aggregation returns 3 rows and 3 columns. For different groups, the schema must be consistent (field order, field count, and type).
println!("{}", res);
<span class="boring">}</span></code></pre></pre>
<p>Output</p>
<pre><code class="language-term">shape: (12, 4)
┌───────────┬────────┬────────┬────────┐
│ group     ┆ field1 ┆ field2 ┆ field3 │
│ ---       ┆ ---    ┆ ---    ┆ ---    │
│ str       ┆ str    ┆ str    ┆ str    │
╞═══════════╪════════╪════════╪════════╡
│ August    ┆ a1,1   ┆ a1,2   ┆ a1,3   │
│ August    ┆ a2,1   ┆ a2,2   ┆ a2,3   │
│ August    ┆ a3,1   ┆ a3,2   ┆ a3,3   │
│ November  ┆ a1,1   ┆ a1,2   ┆ a1,3   │
│ November  ┆ a2,1   ┆ a2,2   ┆ a2,3   │
│ …         ┆ …      ┆ …      ┆ …      │
│ September ┆ a2,1   ┆ a2,2   ┆ a2,3   │
│ September ┆ a3,1   ┆ a3,2   ┆ a3,3   │
│ October   ┆ a1,1   ┆ a1,2   ┆ a1,3   │
│ October   ┆ a2,1   ┆ a2,2   ┆ a2,3   │
│ October   ┆ a3,1   ┆ a3,2   ┆ a3,3   │
└───────────┴────────┴────────┴────────┘
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../Rust-Polars-API-tutorial/en/Dataframe-分组和简单聚合.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../Rust-Polars-API-tutorial/en/Dataframe-Join操作.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../Rust-Polars-API-tutorial/en/Dataframe-分组和简单聚合.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../Rust-Polars-API-tutorial/en/Dataframe-Join操作.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>


    </div>
    </body>
</html>
